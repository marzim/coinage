{% extends "index.html" %}
{% include "modalform.html" %}
{% block title %}Loans{% endblock %}
{% block head %}
  {{ super() }}
{% endblock %}
{% block content %}
{{ super() }}
{% endblock %}
{% block container %}
{{ super() }}
{% endblock %}
{% block membercontent %}
<ul class="nav nav-tabs actions-nav">
  <li class="active">
    <a href="#">List ({{ query_loans|length }})</a>
  </li>
  {% if  current_user.can_create: %}
  <li>
    <a href="{{ url_for('loans.newloans')}}" title="Create New Loan">Create</a>
  </li>
  {% endif %}
</ul>
  <table class="table table-striped table-bordered table-condensed table-hover">
    <thead>
      <tr>
        {% if  current_user.can_update or current_user.can_delete: %}
          <th class="col-md-1"></th>
        {% endif %}
          <th class="column-header"><a id="loans_sortname" href="/loans/?name={{ sort_order }}" title="Sort by Customer Name">Name
              {% if sort_order == 'desc' %}
                <span class="glyphicon glyphicon-chevron-up"></span>
              {% elif sort_order == 'asc' %}
                <span class="glyphicon glyphicon-chevron-down"></span>
              {% endif %}
          </a></th>
          <th class="column-header"><a id="loans_sortamount" href="/loans/?amount={{ sort_order }}" title="Sort by Amount">Amount
              {% if sort_order == 'desc' %}
                <span class="glyphicon glyphicon-chevron-up"></span>
              {% elif sort_order == 'asc' %}
                <span class="glyphicon glyphicon-chevron-down"></span>
              {% endif %}</a></th>
          <th class="column-header"><a id="loans_sortinterest" href="/loans/?interest={{ sort_order }}" title="Sort by Interest">Interest
              {% if sort_order == 'desc' %}
                <span class="glyphicon glyphicon-chevron-up"></span>
              {% elif sort_order == 'asc' %}
                <span class="glyphicon glyphicon-chevron-down"></span>
              {% endif %}</a></th>
          <th class="column-header"><a id="loans_sorttpayable" href="/loans/?total_payable={{ sort_order }}" title="Sort by Total Payable">Total Payable
              {% if sort_order == 'desc' %}
                <span class="glyphicon glyphicon-chevron-up"></span>
              {% elif sort_order == 'asc' %}
                <span class="glyphicon glyphicon-chevron-down"></span>
              {% endif %}</a></th>
          <th class="column-header"><a id="loans_sorttpayment" href="/loans/?total_payment={{ sort_order }}" title="Sort by Total Payment">Total Payment
              {% if sort_order == 'desc' %}
                <span class="glyphicon glyphicon-chevron-up"></span>
              {% elif sort_order == 'asc' %}
                <span class="glyphicon glyphicon-chevron-down"></span>
              {% endif %}</a></th>
          <th class="column-header"><a id="loans_sortoutbal" href="/loans/?outstanding_balance={{ sort_order }}" title="Sort by Outstanding Balance">Outstanding Balance
              {% if sort_order == 'desc' %}
                <span class="glyphicon glyphicon-chevron-up"></span>
              {% elif sort_order == 'asc' %}
                <span class="glyphicon glyphicon-chevron-down"></span>
              {% endif %}</a></th>
      </tr>
    </thead>
    <tbody>
      {% for loan in query_loans: %}
          <tr>
              {% if current_user.can_update or current_user.can_delete : %}
              <td align="center">
                {% if current_user.can_update: %}
                <a href="{{ url_for('loans.editloans', id=loan.id) }}" data-toggle="tooltip" title="Edit Loan: {{ loan.customer.name }}">
                  <span class="glyphicon glyphicon-pencil"></span>
                </a>
                {% endif %}
                {% if current_user.can_delete : %}
                  <a href="#ConfirmDeleteModal" role="button" data-toggle="modal" class='confirmDelete' data-url="/loans/delete/" data-id="{{ loan.id }}" data-name="{{ loan.customer.name }}" data-amount="{{ loan.amount }}" title="Delete Loan of Customer: {{ loan.customer.name }}">
                      <span class="glyphicon glyphicon-trash"></span>
                  </a>
              {% endif %}
              </td>
              {% endif %}
              <td>{{ loan.customer.name }}</td>
              <td>{{ loan.amount }}</td>
              <td>{{ loan.interest }}</td>
              <td>{{ loan.total_payable }}</td>
              <td>{{ loan.payment }}</td>
              <td>{{ loan.outstanding_balance }}</td>
          </tr>

      {% endfor %}

    </tbody>
  </table>
  {% endblock %}

